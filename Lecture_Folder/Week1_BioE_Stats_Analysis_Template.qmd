---
title: "Biological Data Analysis Report"
subtitle: "A Template for Reproducible Research"
author: "Your Name Here"
date: today
date-format: "MMMM D, YYYY"
format: 
  html:
    theme: cosmo
    toc: true
    toc-depth: 3
    toc-title: "Contents"
    toc-location: left
    number-sections: true
    code-fold: false
    code-tools: true
    code-overflow: wrap
    highlight-style: github
    fig-align: center
    fig-width: 8
    fig-height: 6
  pdf:
    toc: true
    number-sections: true
    colorlinks: true
execute:
  echo: true
  warning: false
  message: false
editor: visual
---

::: {.callout-note collapse="true"}
## How to Use This Template

1.  Save this file with a new name for your project (e.g., "MyExperiment_Analysis.qmd")
2.  Update the YAML header above with your information
3.  Replace the example data with your own data
4.  Modify the analysis sections to fit your research questions
5.  Click "Render" to generate your report

**Keyboard Shortcuts:**

-   Render document: Ctrl+Shift+K (Cmd+Shift+K on Mac)
-   Run code chunk: Ctrl+Enter (Cmd+Enter on Mac)
-   Insert new chunk: Ctrl+Alt+I (Cmd+Option+I on Mac)
:::

# Introduction {#sec-introduction}

::: callout-tip
## Writing Your Introduction

Include background on your research question, why this analysis is important, and what you hope to learn.
:::

This document demonstrates a reproducible analysis workflow for biological data. We will analyze gene expression data across different treatment conditions to determine if treatments have a significant effect on expression levels.

**Research Question:** Do different drug treatments significantly alter the expression of key cancer-related genes (BRCA1 and TP53)?

## Objectives

1.  Load and explore the gene expression dataset
2.  Calculate summary statistics for each treatment group
3.  Visualize the distribution of gene expression
4.  Perform statistical tests to compare treatment groups
5.  Draw conclusions based on the results

# Setup {#sec-setup}

## Load Required Packages

```{r}
#| label: load-packages
#| message: false

# Core tidyverse packages for data manipulation and visualization
library(tidyverse)

# For creating nice tables
library(gt)

# For reading Excel files (if needed)
library(readxl)

# Set a consistent theme for all plots
theme_set(theme_minimal(base_size = 12))

# Set seed for reproducibility (important when using random sampling)
set.seed(42)
```

::: callout-tip
## Package Installation

If you haven't installed these packages yet, run this code once in your console:

``` r
install.packages(c("tidyverse", "gt", "readxl"))
```
:::

# Data {#sec-data}

## Loading Your Data

::: callout-important
## Replace This Section

The code below creates example data. Replace it with code to load your actual data file.
:::

**Option 1: Load from a file**

```{r}
#| label: load-data-file
#| eval: false

# For CSV files:
my_data <- read_csv("path/to/your/data.csv")

# For tab-separated files:
my_data <- read_tsv("path/to/your/data.tsv")

# For Excel files:
my_data <- read_excel("path/to/your/data.xlsx", sheet = 1)

# For base R (if you prefer):
my_data <- read.csv("path/to/your/data.csv")
```

**Option 2: Example data (used in this template)**

```{r}
#| label: create-example-data

# Create simulated gene expression data
# Replace this section with your actual data loading code

gene_expression <- tibble(
  # Sample identifiers
  sample_id = paste0("S", sprintf("%03d", 1:50)),
  
  # Treatment groups (5 treatments, 10 samples each)
  treatment = rep(c("Control", "Drug_A", "Drug_B", "Drug_C", "Drug_D"), each = 10),
  
  # Simulated BRCA1 expression (normalized counts)
  # Different means for each treatment to simulate drug effects
  gene_BRCA1 = c(
    rnorm(10, mean = 100, sd = 15),
    rnorm(10, mean = 150, sd = 20),
    rnorm(10, mean = 80, sd = 12),
    rnorm(10, mean = 120, sd = 18),
    rnorm(10, mean = 95, sd = 14)
  ),
  
  # Simulated TP53 expression
  gene_TP53 = c(
    rnorm(10, mean = 200, sd = 25),
    rnorm(10, mean = 180, sd = 22),
    rnorm(10, mean = 250, sd = 30),
    rnorm(10, mean = 190, sd = 28),
    rnorm(10, mean = 210, sd = 24)
  ),
  
  # Additional metadata
  batch = rep(c("Batch1", "Batch2"), 25),
  cell_line = sample(c("HeLa", "MCF7", "A549"), 50, replace = TRUE)
)

# Convert treatment to a factor with Control as reference level
gene_expression <- gene_expression |>
  mutate(
    treatment = factor(
      treatment, 
      levels = c("Control", "Drug_A", "Drug_B", "Drug_C", "Drug_D")
    )
  )
```

## Data Overview

Let's examine the structure and first few rows of our dataset:

```{r}
#| label: data-structure

# Check dimensions
cat("Dataset dimensions:", nrow(gene_expression), "rows x", ncol(gene_expression), "columns\n")

# View structure
glimpse(gene_expression)
```

```{r}
#| label: tbl-data-preview
#| tbl-cap: "First 10 rows of the gene expression dataset"

gene_expression |>
  head(10) |>
  gt() |>
  fmt_number(columns = c(gene_BRCA1, gene_TP53), decimals = 2) |>
  tab_style(
    style = cell_fill(color = "lightblue"),
    locations = cells_column_labels()
  ) |>
  tab_options(
    table.font.size = "small",
    heading.title.font.size = "medium"
  )
```

## Check for Missing Data

```{r}
#| label: check-missing

# Count missing values in each column
missing_counts <- gene_expression |>
  summarise(across(everything(), ~sum(is.na(.)))) |>
  pivot_longer(everything(), names_to = "variable", values_to = "missing_count")

missing_counts |>
  gt() |>
  tab_header(title = "Missing Value Summary")
```

::: callout-note
## Data Quality Check

Always check for missing values before analysis. If you have missing data, decide whether to remove those observations or use imputation methods.
:::

# Exploratory Data Analysis {#sec-eda}

## Summary Statistics

### Overall Summary

```{r}
#| label: overall-summary

# Basic summary statistics for numeric variables
gene_expression |>
  select(gene_BRCA1, gene_TP53) |>
  summary()
```

### Summary by Treatment Group

```{r}
#| label: tbl-summary-by-treatment
#| tbl-cap: "Summary statistics for BRCA1 and TP53 expression by treatment group"

summary_stats <- gene_expression |>
  group_by(treatment) |>
  summarise(
    n = n(),
    BRCA1_mean = mean(gene_BRCA1),
    BRCA1_sd = sd(gene_BRCA1),
    BRCA1_median = median(gene_BRCA1),
    BRCA1_min = min(gene_BRCA1),
    BRCA1_max = max(gene_BRCA1),
    TP53_mean = mean(gene_TP53),
    TP53_sd = sd(gene_TP53)
  )

summary_stats |>
  gt() |>
  fmt_number(columns = -c(treatment, n), decimals = 2) |>
  tab_spanner(label = "BRCA1", columns = starts_with("BRCA1")) |>
  tab_spanner(label = "TP53", columns = starts_with("TP53")) |>
  tab_style(
    style = cell_fill(color = "#e8f4f8"),
    locations = cells_body(rows = treatment == "Control")
  ) |>
  tab_options(table.font.size = "small")
```

## Data Visualization

### Distribution of BRCA1 Expression

```{r}
#| label: fig-brca1-histogram
#| fig-cap: "Distribution of BRCA1 expression across all samples"
#| fig-height: 4

ggplot(gene_expression, aes(x = gene_BRCA1)) +
  geom_histogram(binwidth = 10, fill = "steelblue", color = "white", alpha = 0.7) +
  geom_density(aes(y = after_stat(count) * 10), color = "darkred", linewidth = 1) +
  labs(
    x = "BRCA1 Expression (normalized counts)",
    y = "Frequency",
    title = "Distribution of BRCA1 Gene Expression"
  ) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
```

### Boxplots by Treatment Group

```{r}
#| label: fig-brca1-boxplot
#| fig-cap: "BRCA1 expression across treatment groups. Each point represents a sample."
#| fig-height: 5

ggplot(gene_expression, aes(x = treatment, y = gene_BRCA1, fill = treatment)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(width = 0.2, alpha = 0.6, size = 2) +
  labs(
    x = "Treatment",
    y = "BRCA1 Expression (normalized counts)",
    title = "BRCA1 Expression by Treatment Group"
  ) +
  scale_fill_brewer(palette = "Set2") +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5, face = "bold")
  )
```

### Comparing Both Genes

```{r}
#| label: fig-both-genes
#| fig-cap: "Comparison of BRCA1 and TP53 expression across treatments"
#| fig-height: 5
#| fig-width: 10

# Reshape data to long format for faceted plotting
gene_long <- gene_expression |>
  pivot_longer(
    cols = c(gene_BRCA1, gene_TP53),
    names_to = "gene",
    values_to = "expression"
  ) |>
  mutate(gene = str_remove(gene, "gene_"))

ggplot(gene_long, aes(x = treatment, y = expression, fill = treatment)) +
  geom_boxplot(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.4, size = 1.5) +
  facet_wrap(~gene, scales = "free_y") +
  labs(
    x = "Treatment",
    y = "Expression (normalized counts)",
    title = "Gene Expression by Treatment"
  ) +
  scale_fill_brewer(palette = "Set2") +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold")
  )
```

### Scatter Plot: Gene Correlation

```{r}
#| label: fig-gene-correlation
#| fig-cap: "Correlation between BRCA1 and TP53 expression, colored by treatment"
#| fig-height: 5

ggplot(gene_expression, aes(x = gene_BRCA1, y = gene_TP53, color = treatment)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", linewidth = 0.5) +
  labs(
    x = "BRCA1 Expression",
    y = "TP53 Expression",
    color = "Treatment",
    title = "BRCA1 vs TP53 Expression"
  ) +
  scale_color_brewer(palette = "Set2") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
```

# Statistical Analysis {#sec-statistics}

## Checking Assumptions

Before performing parametric tests, we should check our assumptions.

### Normality

```{r}
#| label: normality-test

# Shapiro-Wilk test for normality (by group)
normality_tests <- gene_expression |>
  group_by(treatment) |>
  summarise(
    shapiro_BRCA1_p = shapiro.test(gene_BRCA1)$p.value,
    shapiro_TP53_p = shapiro.test(gene_TP53)$p.value
  )

normality_tests |>
  gt() |>
  fmt_number(columns = -treatment, decimals = 4) |>
  tab_header(title = "Shapiro-Wilk Normality Test Results") |>
  tab_footnote("p > 0.05 suggests data is normally distributed")
```

### Homogeneity of Variance

```{r}
#| label: variance-test

# Bartlett's test for homogeneity of variances
bartlett_brca1 <- bartlett.test(gene_BRCA1 ~ treatment, data = gene_expression)
bartlett_tp53 <- bartlett.test(gene_TP53 ~ treatment, data = gene_expression)

cat("Bartlett's Test for BRCA1:\n")
cat("  Test statistic:", round(bartlett_brca1$statistic, 3), "\n")
cat("  p-value:", round(bartlett_brca1$p.value, 4), "\n\n")

cat("Bartlett's Test for TP53:\n")
cat("  Test statistic:", round(bartlett_tp53$statistic, 3), "\n")
cat("  p-value:", round(bartlett_tp53$p.value, 4), "\n")
```

::: callout-note
## Interpreting Assumption Tests

-   **Normality (Shapiro-Wilk):** p \> 0.05 suggests normal distribution
-   **Homogeneity (Bartlett's):** p \> 0.05 suggests equal variances
-   If assumptions are violated, consider non-parametric alternatives (e.g., Kruskal-Wallis test)
:::

## ANOVA: Comparing Treatment Groups

### One-Way ANOVA for BRCA1

```{r}
#| label: anova-brca1

# Perform one-way ANOVA
anova_brca1 <- aov(gene_BRCA1 ~ treatment, data = gene_expression)

# Display ANOVA table
summary(anova_brca1)
```

```{r}
#| label: tbl-anova-results
#| tbl-cap: "ANOVA results for BRCA1 expression"

# Create a nice table of ANOVA results
anova_summary <- broom::tidy(anova_brca1)

anova_summary |>
  gt() |>
  fmt_number(columns = c(sumsq, meansq, statistic), decimals = 2) |>
  fmt_number(columns = p.value, decimals = 4) |>
  tab_style(
    style = cell_fill(color = "lightyellow"),
    locations = cells_body(rows = p.value < 0.05)
  )
```

### Post-hoc Analysis: Tukey's HSD

If the ANOVA is significant, we perform post-hoc tests to determine which groups differ:

```{r}
#| label: tukey-test

# Tukey's Honest Significant Difference test
tukey_results <- TukeyHSD(anova_brca1)
print(tukey_results)
```

```{r}
#| label: fig-tukey-plot
#| fig-cap: "Tukey's HSD confidence intervals. Intervals not crossing zero indicate significant differences."
#| fig-height: 6

# Visualize Tukey results
plot(tukey_results, las = 1, cex.axis = 0.7)
```

## Alternative: Non-parametric Test

If assumptions are not met, use the Kruskal-Wallis test:

```{r}
#| label: kruskal-test

# Kruskal-Wallis test (non-parametric alternative to one-way ANOVA)
kruskal_result <- kruskal.test(gene_BRCA1 ~ treatment, data = gene_expression)
print(kruskal_result)
```

## T-test Example: Comparing Two Groups

```{r}
#| label: t-test

# Compare Control vs Drug_A specifically
control_data <- gene_expression |> 
  filter(treatment == "Control") |> 
  pull(gene_BRCA1)

drug_a_data <- gene_expression |> 
  filter(treatment == "Drug_A") |> 
  pull(gene_BRCA1)

# Two-sample t-test
t_test_result <- t.test(control_data, drug_a_data)
print(t_test_result)
```

# Results Summary {#sec-results}

## Key Findings

```{r}
#| label: results-summary
#| echo: false

# Extract key statistics for reporting
f_stat <- round(summary(anova_brca1)[[1]]["treatment", "F value"], 2)
p_val <- summary(anova_brca1)[[1]]["treatment", "Pr(>F)"]
p_formatted <- ifelse(p_val < 0.001, "< 0.001", round(p_val, 4))

# Calculate effect size (eta-squared)
ss_treatment <- summary(anova_brca1)[[1]]["treatment", "Sum Sq"]
ss_total <- sum(summary(anova_brca1)[[1]][, "Sum Sq"])
eta_sq <- round(ss_treatment / ss_total, 3)
```

Based on our analysis:

1.  **Overall Effect:** There was a statistically significant difference in BRCA1 expression across treatment groups (F = `r f_stat`, p `r p_formatted`).

2.  **Effect Size:** Treatment explained approximately `r eta_sq * 100`% of the variance in BRCA1 expression (η² = `r eta_sq`).

3.  **Pairwise Comparisons:** Post-hoc analysis revealed that:

    -   Drug_A significantly increased BRCA1 expression compared to Control
    -   Drug_B significantly decreased BRCA1 expression compared to Control
    -   Drug_C and Drug_D showed no significant difference from Control

## Results Table

```{r}
#| label: tbl-final-results
#| tbl-cap: "Summary of treatment effects on BRCA1 expression"

# Create a summary table with effect estimates
effect_summary <- gene_expression |>
  group_by(treatment) |>
  summarise(
    mean = mean(gene_BRCA1),
    se = sd(gene_BRCA1) / sqrt(n())
  ) |>
  mutate(
    diff_from_control = mean - mean[treatment == "Control"],
    ci_lower = mean - 1.96 * se,
    ci_upper = mean + 1.96 * se
  )

effect_summary |>
  gt() |>
  fmt_number(columns = -treatment, decimals = 2) |>
  tab_header(
    title = "Treatment Effects Summary",
    subtitle = "BRCA1 Expression"
  ) |>
  cols_label(
    treatment = "Treatment",
    mean = "Mean",
    se = "Std. Error",
    diff_from_control = "Diff. from Control",
    ci_lower = "95% CI Lower",
    ci_upper = "95% CI Upper"
  )
```

# Conclusions {#sec-conclusions}

::: callout-tip
## Writing Your Conclusions

Include a summary of main findings, biological interpretation, limitations, and future directions.
:::

## Summary

This analysis examined the effect of four drug treatments on the expression of cancer-related genes BRCA1 and TP53. Our results demonstrate that:

1.  **Drug_A** significantly upregulates BRCA1 expression, which may have implications for DNA repair mechanisms.

2.  **Drug_B** significantly downregulates BRCA1 expression, warranting further investigation into potential cancer risk.

3.  **Drug_C and Drug_D** do not significantly alter BRCA1 expression compared to control conditions.

## Limitations

-   Sample size was limited (n = 10 per group)
-   Analysis was performed on simulated data for demonstration purposes
-   Additional genes and pathways should be examined

## Future Directions

-   Validate findings with larger sample sizes
-   Investigate downstream effects on cell proliferation
-   Examine dose-response relationships

# Session Information {#sec-session}

For reproducibility, here is the R session information:

```{r}
#| label: session-info
#| echo: false

sessionInfo()
```

------------------------------------------------------------------------

# Appendix: Code Reference {#sec-appendix}

## Useful Code Snippets

### Loading Different File Types

```{r}
#| label: file-loading-reference
#| eval: false

# CSV files
data <- read_csv("file.csv")

# Tab-separated files
data <- read_tsv("file.tsv")

# Excel files
data <- read_excel("file.xlsx", sheet = "Sheet1")

# Fixed-width files
data <- read_fwf("file.txt", fwf_widths(c(10, 20, 15)))
```

### Common dplyr Operations

```{r}
#| label: dplyr-reference
#| eval: false

# Filter rows
data |> filter(treatment == "Control")

# Select columns
data |> select(sample_id, treatment, gene_BRCA1)

# Create new columns
data |> mutate(log_expression = log10(gene_BRCA1))

# Group and summarize
data |> 
  group_by(treatment) |> 
  summarise(mean = mean(gene_BRCA1), sd = sd(gene_BRCA1))

# Arrange (sort)
data |> arrange(desc(gene_BRCA1))
```

### Statistical Tests Quick Reference

```{r}
#| label: stats-reference
#| eval: false

# T-test (two groups)
t.test(group1, group2)
t.test(value ~ group, data = df)

# ANOVA (multiple groups)
aov(value ~ group, data = df)

# Correlation
cor.test(x, y)

# Chi-square test
chisq.test(table(var1, var2))

# Non-parametric alternatives
wilcox.test(group1, group2)
kruskal.test(value ~ group, data = df)
```

### Creating Publication-Ready Figures

```{r}
#| label: ggplot-reference
#| eval: false

# Basic ggplot template
ggplot(data, aes(x = xvar, y = yvar, color = group)) +
  geom_point() +
  labs(
    x = "X Axis Label",
    y = "Y Axis Label",
    title = "Main Title",
    subtitle = "Subtitle",
    caption = "Data source"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold"),
    legend.position = "bottom"
  )

# Save a figure
ggsave("figure_name.png", width = 8, height = 6, dpi = 300)
```
